import{x as w,a as d,w as C}from"./chunk-JMJ3UQ3L-DPj_BNs_.js";import{j as t}from"./jsx-runtime-u17CrQMm.js";import{c as S}from"./client-B_XR4Hye.js";import{c as l,p as L,s as m,b,a as P}from"./utils-ByhHhwOs.js";import{b as k}from"./tmdb-configuration-BxuIu_6_.js";import{c as E}from"./createLucideIcon-CMzVMv86.js";const I=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],W=E("plus",I);function A({to:e,children:s}){return t.jsx(w,{to:e,className:"fixed bottom-[calc(env(safe-area-inset-bottom)+5rem)] right-4 flex h-14 w-14 items-center justify-center rounded-full bg-indigo-500 text-white shadow-lg transition-opacity hover:opacity-90",children:s})}function Y({entry:e}){const s=d.useContext(k),a=s.images.poster_sizes.length>2?2:s.images.poster_sizes.length-1,r=s.images.poster_sizes[a]||s.images.poster_sizes[0];return t.jsxs(w,{to:`/app/list/${e.id}`,className:l("group flex gap-4 md:gap-6 items-start rounded-lg p-2 -m-2 transition hover:bg-zinc-100 dark:hover:bg-zinc-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-indigo-500",e.isWatched&&"opacity-70"),children:[e.posterPath&&s.images.secure_base_url&&t.jsx("img",{src:`${s.images.secure_base_url}${r}${e.posterPath}`,alt:e.title,className:"flex-shrink-0 w-16 h-24 object-cover rounded md:w-20 md:h-[120px]"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:l("font-bold text-base md:text-lg",L),children:e.title}),e.releaseYear&&t.jsx("p",{className:l("text-sm md:text-base",m),children:e.releaseYear}),e.tags.length>0&&t.jsx("p",{className:l("text-sm md:text-base",m),children:e.tags.join(", ")})]})]})}function M({entries:e,loading:s,error:a}){const r=e.findIndex(o=>o.isWatched),u=r>0;return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:b,children:t.jsx("h2",{className:P,children:"List of Saved Items"})}),t.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden min-h-0 pb-4",children:[s&&!a&&e.length===0&&t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-zinc-300 border-t-indigo-500"}),t.jsx("p",{className:m,children:"Loading..."})]})}),a&&t.jsx("p",{className:l("text-sm text-red-500",b),children:a}),!s&&!a&&e.length===0&&t.jsx("p",{className:l("text-sm",m),children:"Your list is empty."}),!a&&e.length>0&&t.jsx("div",{className:"space-y-4 md:space-y-6",children:e.flatMap((o,c)=>{const h=[];return u&&c===r&&h.push(t.jsx("h4",{className:l("pt-2 text-xs font-semibold uppercase tracking-wide",m),children:"Watched"},"watched-header")),h.push(t.jsx(Y,{entry:o},o.id)),h})})]}),t.jsx(A,{to:"/app/list/add",children:t.jsx(W,{})})]})}function T(e){return e&&e.split("-")[0]||""}function $(e){return e?Array.isArray(e)?e[0]??null:e:null}function D(e){return e?Array.isArray(e)?e[0]?.name??null:e.name??null:null}function R(){const[e,s]=d.useState([]),[a,r]=d.useState(!0),[u,o]=d.useState(null);return d.useEffect(()=>{let c=!1;return(async()=>{r(!0),o(null);try{const i=S(),{data:p,error:g}=await i.from("entries").select(`
              id,
              added_at,
              watched_at,
              tmdb_details (
                poster_path,
                name,
                release_date
              ),
              entry_tags (
                tags (
                  name
                )
              )
            `).order("added_at",{ascending:!1});if(g)throw g;const j=(p??[]).map(n=>{const f=$(n.tmdb_details),N=f?.name||"Untitled",z=n.entry_tags?.map(x=>D(x.tags)).filter(x=>!!x)??[];return{id:n.id,title:N,releaseYear:T(f?.release_date??null),posterPath:f?.poster_path??null,tags:z,isWatched:!!n.watched_at}}),_=j.filter(n=>!n.isWatched),v=j.filter(n=>n.isWatched),y=[..._,...v];c||s(y)}catch(i){if(!c){const p=i instanceof Error?i.message:typeof i=="object"&&i!==null&&"message"in i&&typeof i.message=="string"?String(i.message):"Failed to load list";o(p),s([])}}finally{c||r(!1)}})(),()=>{c=!0}},[]),t.jsx(M,{entries:e,loading:a,error:u})}function G({}){return[{title:"Video Clerk"},{name:"description",content:'A mobile-first web application that solves the "what do we watch?" conundrum. It separates the **Discovery Phase** (adding things to the list when you hear about them) from the **Decision Phase** (filtering that list based on current mood to find a winner).'}]}const J=C(function(){return t.jsx(R,{})});export{J as default,G as meta};
