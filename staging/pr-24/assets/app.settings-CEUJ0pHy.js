import{a as r,t as q,x as H,w as J}from"./chunk-JMJ3UQ3L-DPj_BNs_.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{c as T,b as A,s as K}from"./utils-ByhHhwOs.js";import{a as Q}from"./app-data-provider-CKFs_dDM.js";import{c as m}from"./client-B_XR4Hye.js";import{A as M}from"./action-button-BX2IeZ2i.js";import{S as E,a as _}from"./settings-subsection-X7Eq6pXz.js";function N({children:i,showBottomBorder:a=!1}){return e.jsxs(e.Fragment,{children:[i,a&&e.jsx("div",{className:"border-t border-zinc-200 dark:border-zinc-700 my-4"})]})}function x({label:i,value:a}){return e.jsxs("div",{className:"flex items-center justify-between my-2 first:mt-0 last:mb-0",children:[e.jsx("span",{className:"text-sm font-medium flex-shrink-0",children:i}),e.jsx("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:a})]})}function P({className:i,...a}){return e.jsx(M,{...a,className:T("w-full sm:w-auto sm:min-w-[140px] sm:self-start",i)})}function W(){const{user:i}=r.useContext(Q),[a,F]=q(),o=a.get("invite"),[c,B]=r.useState(""),[v,b]=r.useState(!1),[d,p]=r.useState(null),[L,w]=r.useState(null),[h,y]=r.useState(null),[D,j]=r.useState(!1),[f,S]=r.useState(!1),[G,I]=r.useState(null),[R,z]=r.useState(!1),[C,V]=r.useState([]),[X,k]=r.useState(!1),[g,U]=r.useState([]);r.useEffect(()=>{if(!i)return;(async()=>{k(!0);try{const n=m(),{data:s,error:l}=await n.rpc("get_group_members");if(l)throw l;V(s||[])}catch(n){console.error("Failed to fetch group members:",n)}finally{k(!1)}})()},[i,f]),r.useEffect(()=>{if(!i)return;(async()=>{try{const n=m(),{data:s,error:l}=await n.rpc("get_pending_group_invites");if(l)throw l;U(s||[])}catch(n){console.error("Failed to fetch pending invites:",n)}})()},[i,v,f]);const u=r.useMemo(()=>{const t=d??o;return!t||typeof window>"u"?null:`${window.location.origin}/app/settings?invite=${encodeURIComponent(t)}`},[d,o]),$=async()=>{if(i){b(!0),w(null),p(null);try{const t=m(),{data:n,error:s}=await t.rpc("create_group_invite",{p_invited_email:c});if(s)throw s;p(String(n)),y(c.trim())}catch(t){w(t instanceof Error?t.message:"Failed to create invite")}finally{b(!1)}}},O=async()=>{if(i&&o){j(!0),I(null),S(!1);try{const t=m(),{error:n}=await t.rpc("accept_group_invite",{p_invite_id:o});if(n)throw n;S(!0);const s=new URLSearchParams(a);s.delete("invite"),F(s,{replace:!0})}catch(t){I(t instanceof Error?t.message:"Failed to accept invite")}finally{j(!1)}}},Y=async()=>{if(u)try{await navigator.clipboard.writeText(u),z(!0),setTimeout(()=>z(!1),2e3)}catch(t){console.error("Failed to copy to clipboard:",t)}};return e.jsxs(e.Fragment,{children:[i&&e.jsx(E,{title:"Account",children:e.jsx(N,{children:e.jsx(x,{label:"Email",value:i.email||""})})}),i&&e.jsxs(E,{title:"Group",children:[o&&e.jsx(_,{description:"You have a pending group invite. Accepting it will move you into the inviter's group and you will lose access to any existing saved items.",error:G,success:f?"Invite accepted.":null,showBottomBorder:!0,children:e.jsx(P,{onClick:O,loading:D,loadingText:"Accepting…",children:"Accept invite"})}),(C.length>0||g.length>0)&&e.jsxs(N,{showBottomBorder:!0,children:[C.map((t,n)=>e.jsx(x,{label:n===0?"Members":"",value:t.email},t.user_id)),g.length>0&&e.jsx(e.Fragment,{children:g.map((t,n)=>e.jsx(x,{label:n===0?"Pending Members":"",value:t.invited_email},t.id))})]}),e.jsxs(_,{description:"Invite someone to join your group (they must accept while signed in).",error:L,children:[e.jsx("input",{type:"email",value:c,onChange:t=>{const n=t.target.value;B(n),d&&h&&n.trim()!==h&&(p(null),y(null))},placeholder:"friend@example.com",className:"w-full rounded-md border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 placeholder:text-zinc-400 dark:border-zinc-700 dark:bg-zinc-950 dark:text-zinc-100"}),e.jsx(P,{onClick:$,disabled:c.trim().length===0||d!==null&&c.trim()===h,loading:v,loadingText:"Creating…",children:"Create invite"}),u&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm mb-1",children:"Invite link:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("pre",{className:"flex-1 overflow-x-auto overflow-y-hidden text-sm text-zinc-900 dark:text-zinc-100 bg-zinc-50 dark:bg-zinc-950 border border-zinc-300 dark:border-zinc-700 rounded-md px-3 py-2 whitespace-nowrap",children:u}),e.jsx(M,{onClick:Y,completed:R,completedText:"Copied!",children:"Copy"})]})]})]})]}),e.jsx("div",{className:A,children:e.jsx(H,{to:"/logout",className:"inline-flex items-center justify-center rounded-md border border-zinc-300 bg-white px-4 py-2 text-sm font-medium text-zinc-700 transition-colors hover:bg-zinc-50 dark:border-zinc-600 dark:bg-zinc-800 dark:text-zinc-200 dark:hover:bg-zinc-700",children:"Log Out"})}),e.jsx("div",{className:A,children:e.jsx("p",{className:T("text-sm",K),children:"This application uses TMDB and the TMDB APIs but is not endorsed, certified, or otherwise approved by TMDB."})})]})}function ae({}){return[{title:"Video Clerk"},{name:"description",content:'A mobile-first web application that solves the "what do we watch?" conundrum. It separates the **Discovery Phase** (adding things to the list when you hear about them) from the **Decision Phase** (filtering that list based on current mood to find a winner).'}]}const oe=J(function(){return e.jsx(W,{})});export{oe as default,ae as meta};
