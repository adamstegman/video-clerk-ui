import{a as n,w as R}from"./chunk-JMJ3UQ3L-DtOYCHaw.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{c as T}from"./client-B_XR4Hye.js";import{b as F}from"./tmdb-configuration-BLNbPS70.js";import{a as A,c as m,s as f,p as Y}from"./utils-ByhHhwOs.js";function I(t,u,h){return Math.min(h,Math.max(u,t))}function M(t){return{x:t.clientX,y:t.clientY}}function O({entry:t,isTop:u,style:h,onPointerDown:j,likeOpacity:b,nopeOpacity:w}){const a=n.useContext(F),r=n.useMemo(()=>{const l=a.images.poster_sizes;if(!l.length)return null;const x=l.length>4?3:l.length-1;return l[x]||l[0]||null},[a.images.poster_sizes]),g=n.useMemo(()=>{const l=a.images.backdrop_sizes;if(!l.length)return null;const x=l.length>2?1:l.length-1;return l[x]||l[0]||null},[a.images.backdrop_sizes]),p=a.images.secure_base_url&&(t.backdropPath||t.posterPath)?t.backdropPath&&g?`${a.images.secure_base_url}${g}${t.backdropPath}`:t.posterPath&&r?`${a.images.secure_base_url}${r}${t.posterPath}`:null:null;return e.jsx("div",{className:m("absolute inset-0 rounded-2xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 shadow-lg","overflow-hidden select-none touch-none",u?"cursor-grab active:cursor-grabbing":"pointer-events-none"),style:h,onPointerDown:j,role:u?"group":void 0,"aria-label":u?`Swipe card for ${t.title}`:void 0,children:e.jsxs("div",{className:"flex h-full w-full flex-col",children:[e.jsxs("div",{className:"relative w-full flex-none shrink-0 basis-[62%]",children:[p?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:p,alt:t.title,className:"absolute inset-0 h-full w-full object-cover",draggable:!1}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/45 via-black/15 to-black/0"})]}):e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-zinc-900 via-zinc-800 to-zinc-700"}),e.jsx("div",{className:"absolute left-4 top-4 rounded-lg border-2 border-emerald-300 bg-emerald-500/10 px-3 py-1 text-lg font-extrabold tracking-widest text-emerald-100",style:{opacity:b},children:"LIKE"}),e.jsx("div",{className:"absolute right-4 top-4 rounded-lg border-2 border-rose-300 bg-rose-500/10 px-3 py-1 text-lg font-extrabold tracking-widest text-rose-100",style:{opacity:w},children:"NOPE"})]}),e.jsxs("div",{className:"flex-1 min-h-0 border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 px-5 pt-5 pb-6",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("h3",{className:m("text-xl font-bold",Y),children:t.title}),t.releaseYear&&e.jsx("span",{className:m("text-sm",f),children:t.releaseYear})]}),t.overview&&e.jsx("p",{className:m("mt-2 line-clamp-4 text-sm",f),children:t.overview}),e.jsx("p",{className:m("mt-3 text-xs",f),children:t.mediaType==="movie"?"Movie":t.mediaType==="tv"?"TV":t.mediaType})]})]})})}function U({initialEntries:t,loading:u,error:h,onReload:j}){const[b,w]=n.useState([]),[a,r]=n.useState([]),[g,p]=n.useState(null),[l,x]=n.useState(!1),[v,N]=n.useState(null),[D,P]=n.useState(!1),[c,y]=n.useState({activeId:null,startX:0,startY:0,dx:0,dy:0,isDragging:!1,animatingOut:!1,decision:null}),z=n.useRef(null);n.useEffect(()=>{w(t),r([]),p(null),x(!1),N(null),P(!1),y({activeId:null,startX:0,startY:0,dx:0,dy:0,isDragging:!1,animatingOut:!1,decision:null})},[t]),n.useEffect(()=>()=>{z.current&&window.clearTimeout(z.current)},[]);const d=b[0]??null,$=b.slice(1,4),C=110,k=t.length===0?0:t.length<3?1:3,E=k>0&&a.length>=k&&!D,W=d?I(Math.max(0,c.dx)/C,0,1):0,X=d?I(Math.max(0,-c.dx)/C,0,1):0;function S(s){if(!d)return;const i=s==="like"?420:-420;y(o=>({...o,animatingOut:!0,decision:s,dx:i,dy:o.dy,isDragging:!1,activeId:d.id})),z.current&&window.clearTimeout(z.current),z.current=window.setTimeout(()=>{w(o=>o.slice(1)),s==="like"&&r(o=>o.length>=k?o:[...o,d]),y({activeId:null,startX:0,startY:0,dx:0,dy:0,isDragging:!1,animatingOut:!1,decision:null})},220)}async function L(s){x(!0),N(null),P(!1);try{const i=T(),{error:o}=await i.from("entries").update({watched_at:new Date().toISOString()}).eq("id",s);if(o)throw o;P(!0),await j()}catch(i){const o=i instanceof Error?i.message:typeof i=="object"&&i!==null&&"message"in i&&typeof i.message=="string"?String(i.message):"Failed to mark watched";N(o)}finally{x(!1)}}return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 pb-2 pt-4",children:[e.jsx("h2",{className:A,children:"Watch"}),e.jsx("p",{className:m("mt-1 text-sm",f),children:"Swipe right to like, left to skip. Pick 1 once you have 3 likes."})]}),e.jsxs("div",{className:"flex-1 min-h-0 pb-4 overflow-y-auto",children:[u&&!h&&b.length===0&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-zinc-300 border-t-indigo-500"}),e.jsx("p",{className:f,children:"Loading..."})]})}),h&&e.jsx("p",{className:"text-sm text-red-500",children:h}),!u&&!h&&b.length===0&&a.length<3&&e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-12 text-center",children:[e.jsx("p",{className:m("text-sm",f),children:"No unwatched items to swipe on."}),e.jsx("button",{className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500",onClick:()=>void j(),children:"Reload"})]}),E?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:m("text-sm",f),children:["You liked ",a.length,". Pick one to watch:"]}),e.jsx("div",{className:"grid gap-3 md:grid-cols-3",children:(k===1?a:a.slice(0,3)).map(s=>e.jsxs("button",{className:m("rounded-xl border p-4 text-left transition","bg-white dark:bg-zinc-950 border-zinc-200 dark:border-zinc-800 hover:border-indigo-400",g===s.id?"ring-2 ring-indigo-500":""),onClick:()=>p(s.id),children:[e.jsx("div",{className:m("font-semibold",Y),children:s.title}),s.releaseYear&&e.jsx("div",{className:m("text-sm",f),children:s.releaseYear}),s.overview&&e.jsx("div",{className:m("mt-2 text-sm line-clamp-3",f),children:s.overview})]},s.id))}),v&&e.jsx("p",{className:"text-sm text-red-500",children:v}),D&&e.jsx("p",{className:m("text-sm text-indigo-600 dark:text-indigo-400"),children:"Marked watched."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"rounded-lg border border-zinc-200 dark:border-zinc-800 px-4 py-2 text-sm font-semibold hover:bg-zinc-50 dark:hover:bg-zinc-900",onClick:()=>{r([]),p(null),N(null),P(!1)},disabled:l,children:"Start over"}),e.jsx("button",{className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-60",onClick:()=>{g&&L(g)},disabled:!g||l,children:l?"Marking...":"Watch this"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mx-auto flex h-full w-full max-w-md flex-col",children:[e.jsxs("div",{className:"relative flex-1 min-h-[440px] md:min-h-[520px]",children:[d&&e.jsx(O,{entry:d,isTop:!0,likeOpacity:W,nopeOpacity:X,style:{zIndex:50,transform:`translate3d(${c.dx}px, ${c.dy}px, 0) rotate(${c.dx/14}deg)`,transition:c.isDragging?"none":"transform 220ms ease"},onPointerDown:s=>{if(!d||c.animatingOut||a.length>=k)return;s.currentTarget.setPointerCapture(s.pointerId);const{x:i,y:o}=M(s);y(_=>({..._,activeId:d.id,startX:i,startY:o,dx:0,dy:0,isDragging:!0,animatingOut:!1,decision:null}))}}),$.map((s,i)=>e.jsx(O,{entry:s,isTop:!1,likeOpacity:0,nopeOpacity:0,style:{zIndex:40-i,transform:`translate3d(0, ${10+i*10}px, 0) scale(${1-(i+1)*.03})`,transition:"transform 220ms ease"}},s.id)),e.jsx("div",{className:"absolute inset-0",onPointerMove:s=>{if(!d||!c.isDragging||c.activeId!==d.id)return;const{x:i,y:o}=M(s);y(_=>({..._,dx:i-_.startX,dy:o-_.startY}))},onPointerUp:()=>{if(d&&c.isDragging&&c.activeId===d.id){if(c.dx>C)return S("like");if(c.dx<-C)return S("nope");y(s=>({...s,isDragging:!1,dx:0,dy:0}))}},onPointerCancel:()=>{y(s=>({...s,isDragging:!1,dx:0,dy:0}))}})]}),e.jsx("div",{className:"mt-4 flex-shrink-0 pb-2",children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-3",children:[e.jsx("button",{className:"flex-1 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 px-4 py-3 text-sm font-semibold hover:bg-zinc-50 dark:hover:bg-zinc-900 disabled:opacity-60",onClick:()=>S("nope"),disabled:!d||c.animatingOut||a.length>=k,children:"Nope"}),e.jsxs("div",{className:m("text-sm",f),children:["Liked: ",e.jsx("span",{className:"font-semibold",children:a.length}),"/",k||3]}),e.jsx("button",{className:"flex-1 rounded-xl bg-indigo-600 px-4 py-3 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-60",onClick:()=>S("like"),disabled:!d||c.animatingOut||a.length>=k,children:"Like"})]})})]})})]})]})}function V(t){return t&&t.split("-")[0]||""}function q(t){return t?Array.isArray(t)?t[0]??null:t:null}function B(){const[t,u]=n.useState([]),[h,j]=n.useState(!0),[b,w]=n.useState(null),a=n.useCallback(async()=>{j(!0),w(null);try{const r=T(),{data:g,error:p}=await r.from("entries").select(`
            id,
            added_at,
            media_type,
            watched_at,
            tmdb_details (
              poster_path,
              backdrop_path,
              overview,
              name,
              release_date
            )
          `).is("watched_at",null).order("added_at",{ascending:!1}).limit(50);if(p)throw p;const l=(g??[]).map(x=>{const v=q(x.tmdb_details),N=v?.name||"Untitled";return{id:x.id,title:N,overview:v?.overview??null,releaseYear:V(v?.release_date??null),posterPath:v?.poster_path??null,backdropPath:v?.backdrop_path??null,mediaType:x.media_type}});u(l)}catch(r){const g=r instanceof Error?r.message:typeof r=="object"&&r!==null&&"message"in r&&typeof r.message=="string"?String(r.message):"Failed to load watch deck";w(g),u([])}finally{j(!1)}},[]);return n.useEffect(()=>((async()=>{await a()})(),()=>{}),[a]),e.jsx(U,{initialEntries:t,loading:h,error:b,onReload:a})}function Z({}){return[{title:"Video Clerk"},{name:"description",content:'A mobile-first web application that solves the "what do we watch?" conundrum. It separates the **Discovery Phase** (adding things to the list when you hear about them) from the **Decision Phase** (filtering that list based on current mood to find a winner).'}]}const ee=R(function(){return e.jsx(B,{})});export{ee as default,Z as meta};
