import{a as i,t as q,x as H,w as J}from"./chunk-JMJ3UQ3L-DNRSL2Hf.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{b as w,c as h,d as K,e as Q,s as W}from"./utils-ByhHhwOs.js";import{a as X}from"./app-data-provider-BY1zEJmk.js";import{c as p}from"./client-B_XR4Hye.js";import{A as M}from"./action-button-DPyrQP81.js";function _({title:n,children:r}){return e.jsxs("div",{className:w,children:[e.jsx("h2",{className:"text-base font-semibold",children:n}),e.jsx("div",{className:"mt-3 rounded-md border border-zinc-200 bg-white p-4 dark:border-zinc-700 dark:bg-zinc-900",children:r})]})}function T({children:n,showBottomBorder:r=!1}){return e.jsxs(e.Fragment,{children:[n,r&&e.jsx("div",{className:"border-t border-zinc-200 dark:border-zinc-700 my-4"})]})}function b({label:n,value:r}){return e.jsxs("div",{className:"flex items-center justify-between my-2 first:mt-0 last:mb-0",children:[e.jsx("span",{className:"text-sm font-medium flex-shrink-0",children:n}),e.jsx("span",{className:"text-sm text-zinc-600 dark:text-zinc-400",children:r})]})}function P({className:n,...r}){return e.jsx(M,{...r,className:h("w-full sm:w-auto sm:min-w-[140px] sm:self-start",n)})}function F({description:n,children:r,error:d,success:c,showBottomBorder:o=!1}){return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm",children:n}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[r,c&&e.jsx("p",{className:h("text-sm",K),children:c})]}),d&&e.jsx("p",{className:h("mt-2 text-sm",Q),children:d}),o&&e.jsx("div",{className:"border-t border-zinc-200 dark:border-zinc-700 my-4"})]})}function Z(){const{user:n}=i.useContext(X),[r,d]=q(),c=r.get("invite"),[o,B]=i.useState(""),[j,y]=i.useState(!1),[m,x]=i.useState(null),[L,z]=i.useState(null),[f,C]=i.useState(null),[D,I]=i.useState(!1),[g,S]=i.useState(!1),[G,k]=i.useState(null),[R,N]=i.useState(!1),[A,V]=i.useState([]),[ee,E]=i.useState(!1),[v,U]=i.useState([]);i.useEffect(()=>{if(!n)return;(async()=>{E(!0);try{const s=p(),{data:a,error:l}=await s.rpc("get_group_members");if(l)throw l;V(a||[])}catch(s){console.error("Failed to fetch group members:",s)}finally{E(!1)}})()},[n,g]),i.useEffect(()=>{if(!n)return;(async()=>{try{const s=p(),{data:a,error:l}=await s.rpc("get_pending_group_invites");if(l)throw l;U(a||[])}catch(s){console.error("Failed to fetch pending invites:",s)}})()},[n,j,g]);const u=i.useMemo(()=>{const t=m??c;return!t||typeof window>"u"?null:`${window.location.origin}/app/settings?invite=${encodeURIComponent(t)}`},[m,c]),$=async()=>{if(n){y(!0),z(null),x(null);try{const t=p(),{data:s,error:a}=await t.rpc("create_group_invite",{p_invited_email:o});if(a)throw a;x(String(s)),C(o.trim())}catch(t){z(t instanceof Error?t.message:"Failed to create invite")}finally{y(!1)}}},O=async()=>{if(n&&c){I(!0),k(null),S(!1);try{const t=p(),{error:s}=await t.rpc("accept_group_invite",{p_invite_id:c});if(s)throw s;S(!0);const a=new URLSearchParams(r);a.delete("invite"),d(a,{replace:!0})}catch(t){k(t instanceof Error?t.message:"Failed to accept invite")}finally{I(!1)}}},Y=async()=>{if(u)try{await navigator.clipboard.writeText(u),N(!0),setTimeout(()=>N(!1),2e3)}catch(t){console.error("Failed to copy to clipboard:",t)}};return e.jsxs(e.Fragment,{children:[n&&e.jsx(_,{title:"Account",children:e.jsx(T,{children:e.jsx(b,{label:"Email",value:n.email||""})})}),n&&e.jsxs(_,{title:"Group",children:[c&&e.jsx(F,{description:"You have a pending group invite. Accepting it will move you into the inviter's group and you will lose access to any existing saved items.",error:G,success:g?"Invite accepted.":null,showBottomBorder:!0,children:e.jsx(P,{onClick:O,loading:D,loadingText:"Accepting…",children:"Accept invite"})}),(A.length>0||v.length>0)&&e.jsxs(T,{showBottomBorder:!0,children:[A.map((t,s)=>e.jsx(b,{label:s===0?"Members":"",value:t.email},t.user_id)),v.length>0&&e.jsx(e.Fragment,{children:v.map((t,s)=>e.jsx(b,{label:s===0?"Pending Members":"",value:t.invited_email},t.id))})]}),e.jsxs(F,{description:"Invite someone to join your group (they must accept while signed in).",error:L,children:[e.jsx("input",{type:"email",value:o,onChange:t=>{const s=t.target.value;B(s),m&&f&&s.trim()!==f&&(x(null),C(null))},placeholder:"friend@example.com",className:"w-full rounded-md border border-zinc-300 bg-white px-3 py-2 text-sm text-zinc-900 placeholder:text-zinc-400 dark:border-zinc-700 dark:bg-zinc-950 dark:text-zinc-100"}),e.jsx(P,{onClick:$,disabled:o.trim().length===0||m!==null&&o.trim()===f,loading:j,loadingText:"Creating…",children:"Create invite"}),u&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm mb-1",children:"Invite link:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("pre",{className:"flex-1 overflow-x-auto overflow-y-hidden text-sm text-zinc-900 dark:text-zinc-100 bg-zinc-50 dark:bg-zinc-950 border border-zinc-300 dark:border-zinc-700 rounded-md px-3 py-2 whitespace-nowrap",children:u}),e.jsx(M,{onClick:Y,completed:R,completedText:"Copied!",children:"Copy"})]})]})]})]}),e.jsx("div",{className:w,children:e.jsx(H,{to:"/logout",className:"inline-flex items-center justify-center rounded-md border border-zinc-300 bg-white px-4 py-2 text-sm font-medium text-zinc-700 transition-colors hover:bg-zinc-50 dark:border-zinc-600 dark:bg-zinc-800 dark:text-zinc-200 dark:hover:bg-zinc-700",children:"Log Out"})}),e.jsx("div",{className:w,children:e.jsx("p",{className:h("text-sm",W),children:"This application uses TMDB and the TMDB APIs but is not endorsed, certified, or otherwise approved by TMDB."})})]})}function ce({}){return[{title:"Video Clerk"},{name:"description",content:'A mobile-first web application that solves the "what do we watch?" conundrum. It separates the **Discovery Phase** (adding things to the list when you hear about them) from the **Decision Phase** (filtering that list based on current mood to find a winner).'}]}const oe=J(function(){return e.jsx(Z,{})});export{oe as default,ce as meta};
