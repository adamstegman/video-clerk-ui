import{a as n,w as L}from"./chunk-JMJ3UQ3L-DtOYCHaw.js";import{j as e}from"./jsx-runtime-u17CrQMm.js";import{c as O}from"./client-B_XR4Hye.js";import{b as R}from"./tmdb-configuration-BLNbPS70.js";import{a as F,c as m,s as f,p as T}from"./utils-ByhHhwOs.js";function D(t,u,h){return Math.min(h,Math.max(u,t))}function I(t){return{x:t.clientX,y:t.clientY}}function M({entry:t,isTop:u,style:h,onPointerDown:k,likeOpacity:b,nopeOpacity:j}){const a=n.useContext(R),r=n.useMemo(()=>{const l=a.images.poster_sizes;if(!l.length)return null;const x=l.length>4?3:l.length-1;return l[x]||l[0]||null},[a.images.poster_sizes]),g=n.useMemo(()=>{const l=a.images.backdrop_sizes;if(!l.length)return null;const x=l.length>2?1:l.length-1;return l[x]||l[0]||null},[a.images.backdrop_sizes]),p=a.images.secure_base_url&&(t.backdropPath||t.posterPath)?t.backdropPath&&g?`${a.images.secure_base_url}${g}${t.backdropPath}`:t.posterPath&&r?`${a.images.secure_base_url}${r}${t.posterPath}`:null:null;return e.jsx("div",{className:m("absolute inset-0 rounded-2xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 shadow-lg","overflow-hidden select-none touch-none",u?"cursor-grab active:cursor-grabbing":"pointer-events-none"),style:h,onPointerDown:k,role:u?"group":void 0,"aria-label":u?`Swipe card for ${t.title}`:void 0,children:e.jsxs("div",{className:"flex h-full w-full flex-col",children:[e.jsxs("div",{className:"relative w-full flex-none shrink-0 basis-[62%]",children:[p?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:p,alt:t.title,className:"absolute inset-0 h-full w-full object-cover",draggable:!1}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/45 via-black/15 to-black/0"})]}):e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-zinc-900 via-zinc-800 to-zinc-700"}),e.jsx("div",{className:"absolute left-4 top-4 rounded-lg border-2 border-emerald-300 bg-emerald-500/10 px-3 py-1 text-lg font-extrabold tracking-widest text-emerald-100",style:{opacity:b},children:"LIKE"}),e.jsx("div",{className:"absolute right-4 top-4 rounded-lg border-2 border-rose-300 bg-rose-500/10 px-3 py-1 text-lg font-extrabold tracking-widest text-rose-100",style:{opacity:j},children:"NOPE"})]}),e.jsxs("div",{className:"flex-1 min-h-0 border-t border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 px-5 pt-5 pb-6",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("h3",{className:m("text-xl font-bold",T),children:t.title}),t.releaseYear&&e.jsx("span",{className:m("text-sm",f),children:t.releaseYear})]}),t.overview&&e.jsx("p",{className:m("mt-2 line-clamp-4 text-sm",f),children:t.overview}),e.jsx("p",{className:m("mt-3 text-xs",f),children:t.mediaType==="movie"?"Movie":t.mediaType==="tv"?"TV":t.mediaType})]})]})})}function A({initialEntries:t,loading:u,error:h,onReload:k}){const[b,j]=n.useState([]),[a,r]=n.useState([]),[g,p]=n.useState(null),[l,x]=n.useState(!1),[v,y]=n.useState(null),[S,_]=n.useState(!1),[c,w]=n.useState({activeId:null,startX:0,startY:0,dx:0,dy:0,isDragging:!1,animatingOut:!1,decision:null}),N=n.useRef(null);n.useEffect(()=>{j(t),r([]),p(null),x(!1),y(null),_(!1),w({activeId:null,startX:0,startY:0,dx:0,dy:0,isDragging:!1,animatingOut:!1,decision:null})},[t]),n.useEffect(()=>()=>{N.current&&window.clearTimeout(N.current)},[]);const d=b[0]??null,Y=b.slice(1,4),P=110,E=a.length>=3&&!S,$=d?D(Math.max(0,c.dx)/P,0,1):0,W=d?D(Math.max(0,-c.dx)/P,0,1):0;function C(s){if(!d)return;const i=s==="like"?420:-420;w(o=>({...o,animatingOut:!0,decision:s,dx:i,dy:o.dy,isDragging:!1,activeId:d.id})),N.current&&window.clearTimeout(N.current),N.current=window.setTimeout(()=>{j(o=>o.slice(1)),s==="like"&&r(o=>o.length>=3?o:[...o,d]),w({activeId:null,startX:0,startY:0,dx:0,dy:0,isDragging:!1,animatingOut:!1,decision:null})},220)}async function X(s){x(!0),y(null),_(!1);try{const i=O(),{error:o}=await i.from("entries").update({watched_at:new Date().toISOString()}).eq("id",s);if(o)throw o;_(!0),await k()}catch(i){const o=i instanceof Error?i.message:typeof i=="object"&&i!==null&&"message"in i&&typeof i.message=="string"?String(i.message):"Failed to mark watched";y(o)}finally{x(!1)}}return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 pb-2 pt-4",children:[e.jsx("h2",{className:F,children:"Watch"}),e.jsx("p",{className:m("mt-1 text-sm",f),children:"Swipe right to like, left to skip. Pick 1 once you have 3 likes."})]}),e.jsxs("div",{className:"flex-1 min-h-0 pb-4 overflow-y-auto",children:[u&&!h&&b.length===0&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-zinc-300 border-t-indigo-500"}),e.jsx("p",{className:f,children:"Loading..."})]})}),h&&e.jsx("p",{className:"text-sm text-red-500",children:h}),!u&&!h&&b.length===0&&a.length<3&&e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-12 text-center",children:[e.jsx("p",{className:m("text-sm",f),children:"No unwatched items to swipe on."}),e.jsx("button",{className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500",onClick:()=>void k(),children:"Reload"})]}),E?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:m("text-sm",f),children:"You liked 3. Pick one to watch:"}),e.jsx("div",{className:"grid gap-3 md:grid-cols-3",children:a.slice(0,3).map(s=>e.jsxs("button",{className:m("rounded-xl border p-4 text-left transition","bg-white dark:bg-zinc-950 border-zinc-200 dark:border-zinc-800 hover:border-indigo-400",g===s.id?"ring-2 ring-indigo-500":""),onClick:()=>p(s.id),children:[e.jsx("div",{className:m("font-semibold",T),children:s.title}),s.releaseYear&&e.jsx("div",{className:m("text-sm",f),children:s.releaseYear}),s.overview&&e.jsx("div",{className:m("mt-2 text-sm line-clamp-3",f),children:s.overview})]},s.id))}),v&&e.jsx("p",{className:"text-sm text-red-500",children:v}),S&&e.jsx("p",{className:m("text-sm text-indigo-600 dark:text-indigo-400"),children:"Marked watched."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"rounded-lg border border-zinc-200 dark:border-zinc-800 px-4 py-2 text-sm font-semibold hover:bg-zinc-50 dark:hover:bg-zinc-900",onClick:()=>{r([]),p(null),y(null),_(!1)},disabled:l,children:"Start over"}),e.jsx("button",{className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-60",onClick:()=>{g&&X(g)},disabled:!g||l,children:l?"Marking...":"Watch this"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mx-auto flex h-full w-full max-w-md flex-col",children:[e.jsxs("div",{className:"relative flex-1 min-h-[440px] md:min-h-[520px]",children:[d&&e.jsx(M,{entry:d,isTop:!0,likeOpacity:$,nopeOpacity:W,style:{zIndex:50,transform:`translate3d(${c.dx}px, ${c.dy}px, 0) rotate(${c.dx/14}deg)`,transition:c.isDragging?"none":"transform 220ms ease"},onPointerDown:s=>{if(!d||c.animatingOut||a.length>=3)return;s.currentTarget.setPointerCapture(s.pointerId);const{x:i,y:o}=I(s);w(z=>({...z,activeId:d.id,startX:i,startY:o,dx:0,dy:0,isDragging:!0,animatingOut:!1,decision:null}))}}),Y.map((s,i)=>e.jsx(M,{entry:s,isTop:!1,likeOpacity:0,nopeOpacity:0,style:{zIndex:40-i,transform:`translate3d(0, ${10+i*10}px, 0) scale(${1-(i+1)*.03})`,transition:"transform 220ms ease"}},s.id)),e.jsx("div",{className:"absolute inset-0",onPointerMove:s=>{if(!d||!c.isDragging||c.activeId!==d.id)return;const{x:i,y:o}=I(s);w(z=>({...z,dx:i-z.startX,dy:o-z.startY}))},onPointerUp:()=>{if(d&&c.isDragging&&c.activeId===d.id){if(c.dx>P)return C("like");if(c.dx<-P)return C("nope");w(s=>({...s,isDragging:!1,dx:0,dy:0}))}},onPointerCancel:()=>{w(s=>({...s,isDragging:!1,dx:0,dy:0}))}})]}),e.jsx("div",{className:"mt-4 flex-shrink-0 pb-2",children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-3",children:[e.jsx("button",{className:"flex-1 rounded-xl border border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-950 px-4 py-3 text-sm font-semibold hover:bg-zinc-50 dark:hover:bg-zinc-900 disabled:opacity-60",onClick:()=>C("nope"),disabled:!d||c.animatingOut||a.length>=3,children:"Nope"}),e.jsxs("div",{className:m("text-sm",f),children:["Liked: ",e.jsx("span",{className:"font-semibold",children:a.length}),"/3"]}),e.jsx("button",{className:"flex-1 rounded-xl bg-indigo-600 px-4 py-3 text-sm font-semibold text-white hover:bg-indigo-500 disabled:opacity-60",onClick:()=>C("like"),disabled:!d||c.animatingOut||a.length>=3,children:"Like"})]})})]})})]})]})}function U(t){return t&&t.split("-")[0]||""}function V(t){return t?Array.isArray(t)?t[0]??null:t:null}function q(){const[t,u]=n.useState([]),[h,k]=n.useState(!0),[b,j]=n.useState(null),a=n.useCallback(async()=>{k(!0),j(null);try{const r=O(),{data:g,error:p}=await r.from("entries").select(`
            id,
            added_at,
            media_type,
            watched_at,
            tmdb_details (
              poster_path,
              backdrop_path,
              overview,
              name,
              release_date
            )
          `).is("watched_at",null).order("added_at",{ascending:!1}).limit(50);if(p)throw p;const l=(g??[]).map(x=>{const v=V(x.tmdb_details),y=v?.name||"Untitled";return{id:x.id,title:y,overview:v?.overview??null,releaseYear:U(v?.release_date??null),posterPath:v?.poster_path??null,backdropPath:v?.backdrop_path??null,mediaType:x.media_type}});u(l)}catch(r){const g=r instanceof Error?r.message:typeof r=="object"&&r!==null&&"message"in r&&typeof r.message=="string"?String(r.message):"Failed to load watch deck";j(g),u([])}finally{k(!1)}},[]);return n.useEffect(()=>((async()=>{await a()})(),()=>{}),[a]),e.jsx(A,{initialEntries:t,loading:h,error:b,onReload:a})}function Q({}){return[{title:"Video Clerk"},{name:"description",content:'A mobile-first web application that solves the "what do we watch?" conundrum. It separates the **Discovery Phase** (adding things to the list when you hear about them) from the **Decision Phase** (filtering that list based on current mood to find a winner).'}]}const Z=L(function(){return e.jsx(q,{})});export{Z as default,Q as meta};
