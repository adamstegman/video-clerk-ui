import{x as v,a as l,w as C}from"./chunk-JMJ3UQ3L-DPj_BNs_.js";import{j as t}from"./jsx-runtime-u17CrQMm.js";import{c as z}from"./client-B_XR4Hye.js";import{c as o,p as L,s as d,b as g,a as P}from"./utils-ByhHhwOs.js";import{b as S}from"./tmdb-configuration-BxuIu_6_.js";import{c as E}from"./createLucideIcon-CMzVMv86.js";const k=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],A=E("plus",k);function Y({to:e,children:s}){return t.jsx(v,{to:e,className:"fixed bottom-[calc(env(safe-area-inset-bottom)+5rem)] right-4 flex h-14 w-14 items-center justify-center rounded-full bg-indigo-500 text-white shadow-lg transition-opacity hover:opacity-90",children:s})}function I({entry:e}){const s=l.useContext(S),a=s.images.poster_sizes.length>2?2:s.images.poster_sizes.length-1,r=s.images.poster_sizes[a]||s.images.poster_sizes[0];return t.jsxs("div",{className:o("flex gap-4 md:gap-6 items-start",e.isWatched&&"opacity-70"),children:[e.posterPath&&s.images.secure_base_url&&t.jsx("img",{src:`${s.images.secure_base_url}${r}${e.posterPath}`,alt:e.title,className:"flex-shrink-0 w-16 h-24 object-cover rounded md:w-20 md:h-[120px]"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:o("font-bold text-base md:text-lg",L),children:e.title}),e.releaseYear&&t.jsx("p",{className:o("text-sm md:text-base",d),children:e.releaseYear}),e.tags.length>0&&t.jsx("p",{className:o("text-sm md:text-base",d),children:e.tags.join(", ")})]})]})}function T({entries:e,loading:s,error:a}){return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:g,children:t.jsx("h2",{className:P,children:"List of Saved Items"})}),t.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0 pb-4",children:[s&&!a&&e.length===0&&t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-zinc-300 border-t-indigo-500"}),t.jsx("p",{className:d,children:"Loading..."})]})}),a&&t.jsx("p",{className:o("text-sm text-red-500",g),children:a}),!s&&!a&&e.length===0&&t.jsx("p",{className:o("text-sm",d),children:"Your list is empty."}),!a&&e.length>0&&t.jsx("div",{className:"space-y-4 md:space-y-6",children:e.map(r=>t.jsx(I,{entry:r},r.id))})]}),t.jsx(Y,{to:"/app/list/add",children:t.jsx(A,{})})]})}function W(e){return e&&e.split("-")[0]||""}function D(e){return e?Array.isArray(e)?e[0]??null:e:null}function M(e){return e?Array.isArray(e)?e[0]?.name??null:e.name??null:null}function R(){const[e,s]=l.useState([]),[a,r]=l.useState(!0),[j,p]=l.useState(null);return l.useEffect(()=>{let c=!1;return(async()=>{r(!0),p(null);try{const n=z(),{data:m,error:f}=await n.from("entries").select(`
              id,
              added_at,
              watched_at,
              tmdb_details (
                poster_path,
                name,
                release_date
              ),
              entry_tags (
                tags (
                  name
                )
              )
            `).order("added_at",{ascending:!1});if(f)throw f;const x=(m??[]).map(i=>{const h=D(i.tmdb_details),w=h?.name||"Untitled",N=i.entry_tags?.map(u=>M(u.tags)).filter(u=>!!u)??[];return{id:i.id,title:w,releaseYear:W(h?.release_date??null),posterPath:h?.poster_path??null,tags:N,isWatched:!!i.watched_at}}),b=x.filter(i=>!i.isWatched),_=x.filter(i=>i.isWatched),y=[...b,..._];c||s(y)}catch(n){if(!c){const m=n instanceof Error?n.message:typeof n=="object"&&n!==null&&"message"in n&&typeof n.message=="string"?String(n.message):"Failed to load list";p(m),s([])}}finally{c||r(!1)}})(),()=>{c=!0}},[]),t.jsx(T,{entries:e,loading:a,error:j})}function G({}){return[{title:"Video Clerk"},{name:"description",content:'A mobile-first web application that solves the "what do we watch?" conundrum. It separates the **Discovery Phase** (adding things to the list when you hear about them) from the **Decision Phase** (filtering that list based on current mood to find a winner).'}]}const J=C(function(){return t.jsx(R,{})});export{J as default,G as meta};
